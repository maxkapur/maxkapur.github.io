<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Styling -->
  <link rel="stylesheet" href="/assets/main.css" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#fffff5" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#546270" />

  <!-- Favicon -->
  <link rel="shortcut icon" href="/assets/favicon/favicon.ico" type="image/vnd.microsoft.icon" />
  <link rel="icon" href="/assets/favicon/favicon.ico" sizes="any" />
  <link rel="icon" href="/assets/favicon/favicon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="/assets/favicon/favicon_180.png" />
  <link rel="manifest" href="/assets/favicon/site.webmanifest" />

  <!-- Atom feed -->
  <link type="application/atom+xml" rel="alternate" href="https://maxkapur.com/feed.xml" title="Illusion Slopes" />

  <title>Pytest + Ruff + Mypy | Illusion Slopes</title>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Pytest + Ruff + Mypy | Illusion Slopes</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Pytest + Ruff + Mypy" />
<meta name="author" content="Max Kapur" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There is a pytest-ruff plugin for Pytest (a Python testing framework) that will automatically run ruff format --check and ruff check as part of your test suite. The pytest-mypy plugin does the same thing for Mypy. These plugins are handy, but for some reason , the tests they generate are exempted from the pytest -k ... logic. Normally, you can use -k to select a subset of tests to run, but if you install one of the plugins mentioned, that plugin’s tests run no matter what. This can slow you down if, like me, you develop on a slow computer. So, here’s what I use instead of pytest-ruff and pytest-mypy: A humble test/test_qa.py file with three functions. import subprocess import sys from pathlib import Path import mypy.api REPO_ROOT = Path(__file__).parent.parent def test_mypy(): stdout, stderr, returncode = mypy.api.run([str(REPO_ROOT)]) sys.stdout.write(stdout) sys.stderr.write(stderr) assert returncode == 0 def test_ruff_format(): subprocess.run( [sys.executable, &quot;-m&quot;, &quot;ruff&quot;, &quot;format&quot;, &quot;--check&quot;], cwd=REPO_ROOT, check=True, ) def test_ruff_lint(): subprocess.run( [sys.executable, &quot;-m&quot;, &quot;ruff&quot;, &quot;check&quot;], cwd=REPO_ROOT, check=True, ) (I run Mypy via its Python API instead of the command line to save a tiny bit of subprocess.run() overhead, but it doesn’t make a massive difference.) This gets you all the functionality of the plugins, but with two fewer dependencies, and the -k flag works: # Run tests for an in-progress feature and skip QA pytest -k test_some_feature # Run only the QA tests pytest -k test_qa # Run all tests pytest" />
<meta property="og:description" content="There is a pytest-ruff plugin for Pytest (a Python testing framework) that will automatically run ruff format --check and ruff check as part of your test suite. The pytest-mypy plugin does the same thing for Mypy. These plugins are handy, but for some reason , the tests they generate are exempted from the pytest -k ... logic. Normally, you can use -k to select a subset of tests to run, but if you install one of the plugins mentioned, that plugin’s tests run no matter what. This can slow you down if, like me, you develop on a slow computer. So, here’s what I use instead of pytest-ruff and pytest-mypy: A humble test/test_qa.py file with three functions. import subprocess import sys from pathlib import Path import mypy.api REPO_ROOT = Path(__file__).parent.parent def test_mypy(): stdout, stderr, returncode = mypy.api.run([str(REPO_ROOT)]) sys.stdout.write(stdout) sys.stderr.write(stderr) assert returncode == 0 def test_ruff_format(): subprocess.run( [sys.executable, &quot;-m&quot;, &quot;ruff&quot;, &quot;format&quot;, &quot;--check&quot;], cwd=REPO_ROOT, check=True, ) def test_ruff_lint(): subprocess.run( [sys.executable, &quot;-m&quot;, &quot;ruff&quot;, &quot;check&quot;], cwd=REPO_ROOT, check=True, ) (I run Mypy via its Python API instead of the command line to save a tiny bit of subprocess.run() overhead, but it doesn’t make a massive difference.) This gets you all the functionality of the plugins, but with two fewer dependencies, and the -k flag works: # Run tests for an in-progress feature and skip QA pytest -k test_some_feature # Run only the QA tests pytest -k test_qa # Run all tests pytest" />
<link rel="canonical" href="https://maxkapur.com/2025/12/10/pytest-ruff-mypy.html" />
<meta property="og:url" content="https://maxkapur.com/2025/12/10/pytest-ruff-mypy.html" />
<meta property="og:site_name" content="Illusion Slopes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-12-10T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Pytest + Ruff + Mypy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Max Kapur"},"dateModified":"2025-12-10T00:00:00+00:00","datePublished":"2025-12-10T00:00:00+00:00","description":"There is a pytest-ruff plugin for Pytest (a Python testing framework) that will automatically run ruff format --check and ruff check as part of your test suite. The pytest-mypy plugin does the same thing for Mypy. These plugins are handy, but for some reason , the tests they generate are exempted from the pytest -k ... logic. Normally, you can use -k to select a subset of tests to run, but if you install one of the plugins mentioned, that plugin’s tests run no matter what. This can slow you down if, like me, you develop on a slow computer. So, here’s what I use instead of pytest-ruff and pytest-mypy: A humble test/test_qa.py file with three functions. import subprocess import sys from pathlib import Path import mypy.api REPO_ROOT = Path(__file__).parent.parent def test_mypy(): stdout, stderr, returncode = mypy.api.run([str(REPO_ROOT)]) sys.stdout.write(stdout) sys.stderr.write(stderr) assert returncode == 0 def test_ruff_format(): subprocess.run( [sys.executable, &quot;-m&quot;, &quot;ruff&quot;, &quot;format&quot;, &quot;--check&quot;], cwd=REPO_ROOT, check=True, ) def test_ruff_lint(): subprocess.run( [sys.executable, &quot;-m&quot;, &quot;ruff&quot;, &quot;check&quot;], cwd=REPO_ROOT, check=True, ) (I run Mypy via its Python API instead of the command line to save a tiny bit of subprocess.run() overhead, but it doesn’t make a massive difference.) This gets you all the functionality of the plugins, but with two fewer dependencies, and the -k flag works: # Run tests for an in-progress feature and skip QA pytest -k test_some_feature # Run only the QA tests pytest -k test_qa # Run all tests pytest","headline":"Pytest + Ruff + Mypy","mainEntityOfPage":{"@type":"WebPage","@id":"https://maxkapur.com/2025/12/10/pytest-ruff-mypy.html"},"url":"https://maxkapur.com/2025/12/10/pytest-ruff-mypy.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <header class="site-header" role="banner">
    <div class="wrapper"><div class="site-title-wrapper">
        <div>
          <a class="site-title" rel="author" href="/">Illusion Slopes</a>
        </div>
      </div><nav class="site-nav">
      <div class="page-links"><div>
          <a class="page-link" href="/about/">About</a>
        </div><div>
          <a class="page-link" href="/projects/">Projects</a>
        </div><div>
          <a class="page-link" href="/browse/">Browse</a>
        </div></div>
    </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Pytest + Ruff + Mypy</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-12-10T00:00:00+00:00" itemprop="datePublished">
        Dec 10, 2025
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>There is a <a href="https://pypi.org/project/pytest-ruff/">pytest-ruff</a> plugin for
Pytest (a Python testing framework) that will automatically run
<code class="language-plaintext highlighter-rouge">ruff format --check</code> and <code class="language-plaintext highlighter-rouge">ruff check</code> as part of your test suite. The
<a href="https://pypi.org/project/pytest-mypy/">pytest-mypy</a> plugin does the same thing
for Mypy. These plugins are handy, but for some reason , the tests they generate
are exempted from the <code class="language-plaintext highlighter-rouge">pytest -k ...</code> logic. Normally, you can use <code class="language-plaintext highlighter-rouge">-k</code> to
select a subset of tests to run, but if you install one of the plugins
mentioned, that plugin’s tests run no matter what. This can slow you down if,
like me, you develop on a slow computer.</p>

<p>So, here’s what I use instead of pytest-ruff and pytest-mypy: A humble
<code class="language-plaintext highlighter-rouge">test/test_qa.py</code> file with three functions.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="n">mypy.api</span>

<span class="n">REPO_ROOT</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="n">parent</span><span class="p">.</span><span class="n">parent</span>


<span class="k">def</span> <span class="nf">test_mypy</span><span class="p">():</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">returncode</span> <span class="o">=</span> <span class="n">mypy</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="nf">run</span><span class="p">([</span><span class="nf">str</span><span class="p">(</span><span class="n">REPO_ROOT</span><span class="p">)])</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">test_ruff_format</span><span class="p">():</span>
    <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span>
        <span class="p">[</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">,</span> <span class="sh">"</span><span class="s">-m</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">ruff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">format</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">--check</span><span class="sh">"</span><span class="p">],</span>
        <span class="n">cwd</span><span class="o">=</span><span class="n">REPO_ROOT</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_ruff_lint</span><span class="p">():</span>
    <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span>
        <span class="p">[</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">,</span> <span class="sh">"</span><span class="s">-m</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">ruff</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">check</span><span class="sh">"</span><span class="p">],</span>
        <span class="n">cwd</span><span class="o">=</span><span class="n">REPO_ROOT</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></div>

<p>(I run Mypy via its Python API instead of the command line to save a tiny bit of
<code class="language-plaintext highlighter-rouge">subprocess.run()</code> overhead, but it doesn’t make a massive difference.)</p>

<p>This gets you all the functionality of the plugins, but with two fewer
dependencies, and the <code class="language-plaintext highlighter-rouge">-k</code> flag works:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run tests for an in-progress feature and skip QA</span>
pytest <span class="nt">-k</span> test_some_feature

<span class="c"># Run only the QA tests</span>
pytest <span class="nt">-k</span> test_qa

<span class="c"># Run all tests</span>
pytest
</code></pre></div></div>

  </div><div class="related-posts">
    <p>Related posts:</p>
    <ol class="related-post-list">
  <li>
    <div class="related-post-list-entry">
      <a href="/2025/06/04/kubuntu-setup.html"
        title="Similarity score: 265"
      >My poorly automated Kubuntu setup</a>
      &ZeroWidthSpace;
      <span class="post-meta">
        (<time datetime="2025-06-04T00:00:00+00:00">Jun 4, 2025</time>)
      </span>
    </div>
  <li>
    <div class="related-post-list-entry">
      <a href="/2025/09/24/python-scripts.html"
        title="Similarity score: 262"
      >Python scripts</a>
      &ZeroWidthSpace;
      <span class="post-meta">
        (<time datetime="2025-09-24T00:00:00+00:00">Sep 24, 2025</time>)
      </span>
    </div></li>
</ol>
  </div>

  <a class="u-url" href="/2025/12/10/pytest-ruff-mypy.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Illusion Slopes</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Max Kapur</li><li><a class="u-email" href="mailto:max@maxkapur.com">max@maxkapur.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span class="rss-link">via RSS</span></a></li><li><a href="https://github.com/maxkapur"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">maxkapur</span></a></li><li><a href="https://www.linkedin.com/in/maxkapur"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">maxkapur</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>I blog about culture, numerical optimization, and software. I work at a consulting firm as an operations research and numerical modeling specialist. All opinions are my own.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
